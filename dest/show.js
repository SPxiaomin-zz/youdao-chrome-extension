function createAndAppend(e,t){var n=document.createElement("li");n.innerHTML=t,e.appendChild(n)}function parseJSON(e){var t=JSON.parse(e),n=t.translateResult,o=n[0][0].src,r=n[0][0].tgt,a=document.createElement("h2");a.innerHTML=o;var l=document.createElement("ul");createAndAppend(l,r);var s=t.smartResult;if(s)for(var d=s.entries,i=1;i<d.length;i++)createAndAppend(l,d[i]);return[a,l]}function xhr(e,t){var n=new XMLHttpRequest;n.open("POST","https://fanyi.youdao.com/translate?smartresult=dict&smartresult=rule&smartresult=ugc&sessionFrom=null",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send("type=AUTO&i="+searchTxt+"&doctype=json&xmlVersion=1.8&keyfrom=fanyi.web&ue=UTF-8&action=FY_BY_ENTER&typoResult=true"),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var o=parseJSON(n.responseText);e.removeChild(t);for(var r=0;r<o.length;r++)e.appendChild(o[r])}}}function loadContent(){var e=document.getElementById("btn");e.style.display="none";var t=document.getElementById("panel");if(t)for(;t.lastChild;)t.removeChild(t.lastChild);else t=document.createElement("div"),t.setAttribute("id","panel"),document.body.appendChild(t);var n=document.createElement("p");n.innerHTML="查询中，请稍后...",t.appendChild(n),xhr(t,n)}function setAttr(e,t){for(var n=0;n<t.length;n++)e.setAttribute(t[n][0],t[n][1])}function showBtn(e){var t=document.getElementById("btn");if(t)t.style.display="block";else{t=document.createElement("img");var n=[["id","btn"],["src","https://github.com/SPxiaomin/youdao-chrome-extension/blob/master/dest/handian32.png"]];setAttr(t,n),t.style.position="absolute",t.style.pointer="cursor",t.style.zIndex="1000"}t.style.top=e.bottom+window.pageYOffset+10+"px",t.style.left=e.left+window.pageXOffset+"px",document.body.appendChild(t)}function close(){var e=document.getElementById("btn");e&&(e.style.display="none");var t=document.getElementById("panel");t&&document.body.removeChild(t)}var searchTxt;document.onmouseup=function(e){return e.target===document.getElementById("btn")?void loadContent():void chrome.storage.sync.get("enableSwitch",function(e){if(e.enableSwitch){var t=window.getSelection(),n=t.toString();if(n){searchTxt=n;var o=t.getRangeAt(0).getBoundingClientRect();showBtn(o)}else close()}else close()})};